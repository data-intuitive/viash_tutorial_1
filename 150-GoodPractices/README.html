<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #2a211c;
        color: #bdae9d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
    div.sourceCode
      { color: #bdae9d; background-color: #2a211c; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffff00; } /* Alert */
    code span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #44aa43; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #049b0a; } /* Char */
    code span.cn { } /* Constant */
    code span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
    code span.do { color: #0066ff; font-style: italic; } /* Documentation */
    code span.dt { text-decoration: underline; } /* DataType */
    code span.dv { color: #44aa43; } /* DecVal */
    code span.er { color: #ffff00; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #44aa43; } /* Float */
    code span.fu { color: #ff9358; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
    code span.op { } /* Operator */
    code span.pp { font-weight: bold; } /* Preprocessor */
    code span.sc { color: #049b0a; } /* SpecialChar */
    code span.ss { color: #049b0a; } /* SpecialString */
    code span.st { color: #049b0a; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #049b0a; } /* VerbatimString */
    code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
    <style>
    body {
      max-width: 60em
    }
    </style>
</head>
<body>
<h1 id="good-practices">Good practices</h1>
<p>Data Intuitive Tuesday - January 26, 2021</p>
<ul>
<li><a href="#unit-testing-in-viash">Unit testing in viash</a>
<ul>
<li><a href="#tests">Tests</a></li>
</ul></li>
<li><a href="#run-our-component">Run our component</a></li>
<li><a href="#run-ocr-on-the-png-file">Run OCR on the png file</a>
<ul>
<li><a href="#platforms">Platforms</a></li>
<li><a href="#running-the-tests">Running the tests</a></li>
<li><a href="#testing-a-namespace">Testing a namespace</a></li>
</ul></li>
</ul>
<p>In the previous sections, we wrote some software components and strung them together in Bash to form a simple pipeline. While these components work right now, they might soon break for any of the following reasons:</p>
<ul>
<li><p>While adding a feature to one of the components, a developer accidentally introduced a bug.</p></li>
<li><p>A small change in the output of one component causes the other component to break.</p></li>
<li><p>Breaking changes were introduced in the latest version of Python. The component’s script needs to be updated or should be set to using an older version of Python.</p></li>
</ul>
<p>If your component is actively developed, bugs will be introduced at some point. The question is, how long does it take for you to spot the errors? If it is located in infrequently used code, the bug might go unnoticed for months.</p>
<p>For this reason, you should add tests to software components which are being used in a lot of downstream analyses and/or whose results are of critical importance.</p>
<h2 id="unit-testing-in-viash">Unit testing in viash</h2>
<p>We will introduce testing using the same <code>convert_plot</code> we used earlier to introduce the <a href="https://github.com/data-intuitive/viash">viash</a> approach. We already covered the functionality of this component already in the previous sections. In this section, we show how to add (unit) tests. Let see what the directory structure of the (updated) component looks like.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="op">&gt;</span> <span class="ex">tree</span> src/civ6_save_renderer/convert_plot</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ex">src/civ6_save_renderer/convert_plot</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>├── <span class="ex">config.vsh.yaml</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>├── <span class="ex">script.sh</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>└── <span class="bu">test</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    └── <span class="ex">run_test.sh</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="ex">1</span> directory, 3 files</span></code></pre></div>
<p>Just like in the <a href="https://github.com/data-intuitive/viash">viash</a> primer (of the previous section) there is a <a href="https://github.com/data-intuitive/viash">viash</a> config (<code>config.vsh.yaml</code>) and a script (<code>script.sh</code>). Nothing has changed to the script, but something was added to the viash config:</p>
<p><code>src/civ6_save_renderer/convert_plot/config.vsh.yaml</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="fu">functionality</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="at">  </span><span class="fu">name</span><span class="kw">:</span><span class="at"> convert_plot</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="at">  </span><span class="fu">namespace</span><span class="kw">:</span><span class="at"> civ6_save_renderer</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a><span class="at">  </span><span class="fu">description</span><span class="kw">:</span><span class="at"> Convert a plot from pdf to png.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a><span class="at">  </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;1.0&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a><span class="at">  </span><span class="fu">authors</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Robrecht Cannoodt</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="at">      </span><span class="fu">email</span><span class="kw">:</span><span class="at"> rcannood@gmail.com</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="at">      </span><span class="fu">roles</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">maintainer</span><span class="kw">,</span><span class="at"> author</span><span class="kw">]</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a><span class="at">      </span><span class="fu">props</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="fu">github</span><span class="kw">:</span><span class="at"> rcannood</span><span class="kw">,</span><span class="at"> </span><span class="fu">orcid</span><span class="kw">:</span><span class="at"> 0000-0003-3641-729X</span><span class="kw">}</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a><span class="at">  </span><span class="fu">arguments</span><span class="kw">:</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;--input&quot;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a><span class="at">      </span><span class="fu">alternatives</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">-i</span><span class="kw">]</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> file</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a><span class="at">      </span><span class="fu">required</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a><span class="at">      </span><span class="fu">default</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;input.pdf&quot;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a><span class="at">      </span><span class="fu">must_exist</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;A PDF input file.&quot;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;--output&quot;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a><span class="at">      </span><span class="fu">alternatives</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">-o</span><span class="kw">]</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> file</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a><span class="at">      </span><span class="fu">required</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a><span class="at">      </span><span class="fu">default</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;output.png&quot;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a><span class="at">      </span><span class="fu">direction</span><span class="kw">:</span><span class="at"> output</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;Output path.&quot;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a><span class="at">  </span><span class="fu">resources</span><span class="kw">:</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> bash_script</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a><span class="at">      </span><span class="fu">path</span><span class="kw">:</span><span class="at"> script.sh</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a><span class="at">  </span><span class="fu">tests</span><span class="kw">:</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> bash_script</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a><span class="at">      </span><span class="fu">path</span><span class="kw">:</span><span class="at"> test/run_test.sh</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">path</span><span class="kw">:</span><span class="at"> https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a><span class="fu">platforms</span><span class="kw">:</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> docker</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> dpokidov/imagemagick</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true"></a><span class="at">    </span><span class="fu">setup</span><span class="kw">:</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> apt</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true"></a><span class="at">        </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="st">&quot;tesseract-ocr&quot;</span><span class="at"> </span><span class="kw">]</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> nextflow</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> dpokidov/imagemagick</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> native</span></span></code></pre></div>
<p>The only differences with before are:</p>
<ol type="1">
<li>The addition of the <code>tests</code> under <code>functionality</code>.</li>
<li>An extra <code>apt</code> package to be installed for running the tests (see later).</li>
</ol>
<h3 id="tests">Tests</h3>
<p>Specifying the tests is not different from specifying the <code>resources</code> in the <a href="https://github.com/data-intuitive/viash">viash</a> configuration. In this case, we have two resources: one is the script that contains the test code and one is a dummy PDF file that is fetched from the web during testing. We could also add a PDF file to the repository and point to that instead.</p>
<p>Let’s take a look at the test script. #!/usr/bin/env bash</p>
<p>set -ex</p>
<h1 id="run-our-component">Run our component</h1>
<p>convert_plot<br />
-i dummy.pdf<br />
-o dummy.png</p>
<p>[[ ! -f dummy.png ]] &amp;&amp; echo “No output generated!” &amp;&amp; exit 1</p>
<h1 id="run-ocr-on-the-png-file">Run OCR on the png file</h1>
<p>tesseract dummy.png dummy-ocr</p>
<p>[[ ! <code>grep Dummy dummy-ocr.txt</code> ]] &amp;&amp; echo “Not the correct content” &amp;&amp; exit 1</p>
<p>echo “&gt;&gt;&gt; Test finished successfully”</p>
<p>The test script itself defines two tests, namely: 1. A test to see if an output file is effectively created by our component 2. A test that extracts the text from the resulting <code>png</code> file in order to verify the content is still the same as the original.</p>
<p>In order to run the second step, we install a package <a href="https://opensource.google/projects/tesseract"><code>tesseract</code></a> that performs the OCR.</p>
<h3 id="platforms">Platforms</h3>
<p>The only difference with the <code>platforms</code> definition earlier is the installation of an additional package in the container.</p>
<h3 id="running-the-tests">Running the tests</h3>
<p>In order to run the tests using the default platform (<code>docker</code> in our current example), we can simply run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="op">&gt;</span> <span class="ex">viash</span> test src/civ6_save_renderer/convert_plot/config.vsh.yaml</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="ex">Running</span> tests in temporary directory: <span class="st">&#39;&lt;...&gt;/workspace/viash_temp/viash_test_convert_plot1100390243068873655&#39;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>====================================================================</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="ex">+</span><span class="op">&lt;</span>...<span class="op">&gt;</span>/workspace/viash_temp/viash_test_convert_plot1100390243068873655/build_executable/convert_plot ---setup</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="op">&gt;</span> <span class="ex">docker</span> build -t civ6_save_renderer/convert_plot:1.0 <span class="op">&lt;</span>...<span class="op">&gt;</span>/workspace/viash_temp/viashsetupdocker-convert_plot-2PPu8p</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="ex">Sending</span> build context to Docker daemon  17.41kB</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="ex">Step</span> 1/2 : FROM dpokidov/imagemagick</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a> <span class="ex">---</span><span class="op">&gt;</span> 0ce61e775be8</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="ex">Step</span> 2/2 : RUN apt-get update <span class="kw">&amp;&amp;</span>   <span class="ex">apt-get</span> install -y tesseract-ocr <span class="kw">&amp;&amp;</span>   <span class="fu">rm</span> -rf /var/lib/apt/lists/*</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a> <span class="ex">---</span><span class="op">&gt;</span> Using cache</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a> <span class="ex">---</span><span class="op">&gt;</span> a92be5886a41</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="ex">Successfully</span> built a92be5886a41</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="ex">Successfully</span> tagged civ6_save_renderer/convert_plot:1.0</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>====================================================================</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="ex">+</span><span class="op">&lt;</span>...<span class="op">&gt;</span>/workspace/viash_temp/viash_test_convert_plot1100390243068873655/test_run_test.sh/run_test.sh</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="ex">+</span> convert_plot -i dummy.pdf -o dummy.png</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="ex">convert</span>: profile <span class="st">&#39;icc&#39;</span>: <span class="st">&#39;RGB &#39;</span>: RGB color space not permitted on grayscale PNG <span class="kw">`</span><span class="ex">dummy.png</span><span class="st">&#39; @ warning/png.c/MagickPNGWarningHandler/1748.</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="st">+ [[ ! -f dummy.png ]]</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="st">+ tesseract dummy.png dummy-ocr</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="st">Tesseract Open Source OCR Engine v4.0.0 with Leptonica</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="st">Warning: Invalid resolution 0 dpi. Using 70 instead.</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="st">Estimating resolution as 157</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a><span class="st">++ grep Dummy dummy-ocr.txt</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="st">+ [[ ! -n Dummy PDF file ]]</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a><span class="st">+ echo &#39;</span><span class="op">&gt;&gt;&gt;</span> Test finished successfully<span class="st">&#39;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a><span class="st">&gt;&gt;&gt; Test finished successfully</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a><span class="st">====================================================================</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a><span class="st">SUCCESS! All 1 out of 1 test scripts succeeded!</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a><span class="st">Cleaning up temporary directory</span></span></code></pre></div>
<p>Let us break down what happens here:</p>
<ol type="1">
<li><a href="https://github.com/data-intuitive/viash">viash</a> creates a temporary directory (configurable via <code>$VIASH_TEMP</code>)</li>
<li>The setup of the appropriate platform is executed</li>
<li>The executable for the component is built in the temporary directory</li>
<li>The test script is run</li>
</ol>
<p>If tests are successful, the temporary directory is removed (unless <code>--keep</code> is provided as an option to <code>viash test</code>).</p>
<p>This is a quick way to run a test on a component.</p>
<h2 id="testing-a-namespace">Testing a namespace</h2>
<p>Similar to building a whole namespace, it is possible to test a whole namespace as well using the <code>viash ns test</code> command.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="op">&gt;</span> <span class="ex">viash</span> ns test -p docker --parallel --tsv /tmp/report.tsv</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>           <span class="ex">namespace</span>        functionality             platform            test_name exit_code duration               result</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>         parse_header               docker                start                                        </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>      <span class="ex">markdown_tools</span>         render_table               docker                start                                        </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>        combine_plots               docker                start                                        </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>            parse_map               docker                start                                        </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>         convert_plot               docker                start                                        </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>             plot_map               docker                start                                        </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>         parse_header               docker     build_executable         0        0              SUCCESS</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>         parse_header               docker                tests        -1        0              MISSING</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>             plot_map               docker     build_executable         0        0              SUCCESS</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>             plot_map               docker                tests        -1        0              MISSING</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>         convert_plot               docker     build_executable         0        0              SUCCESS</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>         convert_plot               docker          run_test.sh         0        3              SUCCESS</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>      <span class="ex">markdown_tools</span>         render_table               docker     build_executable         0        6              SUCCESS</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>      <span class="ex">markdown_tools</span>         render_table               docker                tests        -1        0              MISSING</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>            parse_map               docker     build_executable         0        6              SUCCESS</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>            parse_map               docker                tests        -1        0              MISSING</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>        combine_plots               docker     build_executable         0        6              SUCCESS</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>  <span class="ex">civ6_save_renderer</span>        combine_plots               docker          run_test.sh         0        7              SUCCESS</span></code></pre></div>
<p>With the <code>--parallel</code> option multiple tests are run in parallel (depending on your setup and the way Docker is configured).</p>
<p>The contents of (the optional) <code>report.tsv</code> contains a report of the test run:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">namespace</th>
<th style="text-align: left;">functionality</th>
<th style="text-align: left;">platform</th>
<th style="text-align: left;">test_name</th>
<th style="text-align: right;">exit_code</th>
<th style="text-align: right;">duration</th>
<th style="text-align: left;">result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">parse_header</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">build_executable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="even">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">parse_header</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">tests</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">MISSING</td>
</tr>
<tr class="odd">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">plot_map</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">build_executable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="even">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">plot_map</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">tests</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">MISSING</td>
</tr>
<tr class="odd">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">convert_plot</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">build_executable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="even">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">convert_plot</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">run_test.sh</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">markdown_tools</td>
<td style="text-align: left;">render_table</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">build_executable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="even">
<td style="text-align: left;">markdown_tools</td>
<td style="text-align: left;">render_table</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">tests</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">MISSING</td>
</tr>
<tr class="odd">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">parse_map</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">build_executable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="even">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">parse_map</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">tests</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">MISSING</td>
</tr>
<tr class="odd">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">combine_plots</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">build_executable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
<tr class="even">
<td style="text-align: left;">civ6_save_renderer</td>
<td style="text-align: left;">combine_plots</td>
<td style="text-align: left;">docker</td>
<td style="text-align: left;">run_test.sh</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">SUCCESS</td>
</tr>
</tbody>
</table>
<p>For each component, you see the 2 steps from above: 1) build the executable and 2) run the actual test.</p>
<p>It should be noted that the tests are still running in their respective containers.</p>
</body>
</html>
